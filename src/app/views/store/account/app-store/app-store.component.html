<div *ngIf="pageLoader" class="row">
  <app-spinner></app-spinner>
</div>

<div class="apps-section" *ngIf="!pageLoader">
  <div class="breadcrumb with-back-btn">
    <div class="row">
      <div class="col-md-8">
        <h1>Apps</h1>
        <ul><li style="padding: 0px;">View and manage your apps</li></ul>
      </div>
      <div class="col-md-4 d-flex align-items-center justify-content-end mt-sm-15" align="right">
        <button type="button" routerLink="/account/app-store/payments" class="btn btn-primary">Payments</button>
      </div>
    </div>
  </div>
  <div class="separator-breadcrumb border-top"></div>

  <div class="top-filter-sec">
    <div class="row mb-2">
      <div class="col-md-6">
        <div class="form-group">
          <select name="type" (change)="onChange(selected_package);" [(ngModel)]="selected_package" class="form-control select-arrow">
            <option value="all">All</option>
            <ng-container *ngFor="let x of package_list;">
              <option [value]="x._id">{{x.name}}</option>
            </ng-container>
          </select>
        </div>
      </div>
      <div class="col-md-6">
        <div class="form-group">
          <input type="text" name="search_bar" placeholder="Search" class="form-control" [(ngModel)]="search_bar" />
        </div>
      </div>
    </div>
  </div>

  <div class="apps-cards-section mt-5">
    <div class="row">
      <div *ngFor="let x of list | orderAsc:'rank' | fieldSearch:'name':search_bar;" class="col-md-4 d-flex">
        <div class="card apps-card w-100 p-3 mb-4" (click)="onSelectApp(x, alertModal);">
          <div class="app-image">
            <span *ngIf="!x.image_list.length" class="material-icons-outlined">widgets</span>
            <img *ngIf="x.image_list.length" [src]="imgBaseUrl+x.image_list[0].image" alt="app-icons">
          </div>
          <div class="app-content">
            <h5>{{x.name}}</h5>
            <div class="app-description">
              <p class="two-line-txt-ellipsis" [innerHTML]="x.description"></p>
            </div>
            <div *ngIf="commonService.ys_features.indexOf(x.keyword)!=-1 && !x.deploy_data" class="app-indicator">
              <div class="app-installed">
                <i class="material-icons">check_circle</i> App Installed
              </div>
            </div>
            <div *ngIf="x.deploy_data?.status=='active'" class="app-indicator">
              <div *ngIf="x.deploy_data?.paid" class="app-installed">
                <i class="material-icons">check_circle</i> App Installed
              </div>
              <div *ngIf="!x.deploy_data?.paid" class="app-not-installed">
                <i class="material-icons">paid</i> Make payment
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ALERT MODAL -->
<ng-template #alertModal let-modal>
  <div class="modal-body">
    <p><strong>Please choose the right plan for your business before use the apps</strong></p>
  </div>
  <div class="modal-footer">
    <button type="button" id="closeModal" class="btn btn-wide black-outline-btn" (click)="modal.dismiss('Cross click');">
      <span class="black-outline-txt">Close</span>
    </button>
    <button type="button" (click)="modal.dismiss('Cross click');" routerLink="/deployment/plans" class="btn btn-wide orng-outline-btn">
      <span class="black-outline-txt">Choose Plan</span>
    </button>
  </div>
</ng-template>